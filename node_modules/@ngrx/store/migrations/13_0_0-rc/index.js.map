{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../modules/store/migrations/13_0_0-rc/index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as ts from 'typescript';\nimport { Rule, chain, Tree } from '@angular-devkit/schematics';\nimport {\n  visitTSSourceFiles,\n  RemoveChange,\n  commitChanges,\n  InsertChange,\n} from '../../schematics-core';\n\nfunction updateCreateSelectorGenerics(): Rule {\n  return (tree: Tree) => {\n    visitTSSourceFiles(tree, (sourceFile) => {\n      const runMigration = sourceFile.statements\n        .filter(ts.isImportDeclaration)\n        .filter(\n          (importDeclaration) =>\n            importDeclaration.moduleSpecifier.getText(sourceFile) ===\n              \"'@ngrx/store'\" ||\n            importDeclaration.moduleSpecifier.getText(sourceFile) ===\n              '\"@ngrx/store\"'\n        )\n        .some((importDeclaration) => {\n          return importDeclaration.importClause?.namedBindings\n            ?.getText(sourceFile)\n            .includes('createSelector');\n        });\n\n      if (!runMigration) return;\n\n      const changes: (RemoveChange | InsertChange)[] = [];\n      ts.forEachChild(sourceFile, crawl);\n      return commitChanges(tree, sourceFile.fileName, changes);\n\n      function crawl(node: ts.Node) {\n        ts.forEachChild(node, crawl);\n\n        if (!ts.isCallExpression(node)) return;\n\n        const { typeArguments } = node;\n\n        if (!typeArguments?.length) return;\n        const typeArgumentsLength = typeArguments?.length;\n        if (typeArgumentsLength < 3) return;\n        if (!ts.isIdentifier(node.expression)) return;\n        if (node.expression.text !== 'createSelector') return;\n\n        const lastTypeArgumentIndex = typeArgumentsLength - 1;\n        const slicesTypeArguments = typeArguments.slice(\n          1,\n          lastTypeArgumentIndex\n        );\n        const updatedTypeArguments = [\n          typeArguments[0],\n          slicesTypeArguments,\n          typeArguments[lastTypeArgumentIndex],\n        ];\n\n        const isSelectorWithProps =\n          node.arguments.length === typeArguments.length - 2;\n        if (isSelectorWithProps) return;\n\n        const newTypeArguments = updatedTypeArguments\n          .map((arg) =>\n            Array.isArray(arg)\n              ? `[${arg.map((a) => a.getText(sourceFile)).join(',')}]`\n              : arg.getText(sourceFile)\n          )\n          .join(',');\n\n        changes.push(\n          new RemoveChange(\n            sourceFile.fileName,\n            typeArguments.pos,\n            typeArguments?.end\n          ),\n          new InsertChange(\n            sourceFile.fileName,\n            typeArguments.pos,\n            newTypeArguments\n          )\n        );\n      }\n    });\n  };\n}\n\nexport default function (): Rule {\n  return chain([updateCreateSelectorGenerics]);\n}\n"]}